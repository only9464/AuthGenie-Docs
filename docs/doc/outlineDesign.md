---
title: 概要设计说明书
icon: famicons:cog-outline
createTime: 2026/01/13 00:20:08
permalink: /doc/outlineDesign/
---

## 一、引言

### 1.1 编写目的
给出 AuthGenie（灵域）系统的总体设计、模块划分与接口要点，作为研发与协作的统一参考。

### 1.2 项目背景
本系统为面向多平台软件授权管理与数据分析的 SaaS 平台，基于 Cloudflare Workers 构建，提供官网门户、角色化 Dashboard、统一授权验证接口与数据统计能力。

### 1.3 术语
| 缩写/术语 | 解释 |
| --- | --- |
| Cloudflare Workers | Serverless 运行环境 |
| D1 | 关系型数据库 |
| R2 | 对象存储 |
| KV | 键值存储 |
| 许可证 | 项目授权凭证 |
| 项目 ID | 项目唯一标识 |

### 1.4 参考资料
- `docs/doc/README.md`

## 二、任务概述

### 2.1 系统描述
系统按三类角色提供不同权限的管理与数据视图，支持团队/项目管理、许可证生成与验证、访问数据统计与日志审计。

### 2.2 运行环境
- 运行平台：Cloudflare Workers。
- 存储：D1（结构化数据）、R2（对象资源）、KV（轻量配置/缓存）。
- 敏感信息：通过环境变量提供（超级管理员账号与密码等）。

### 2.3 条件与限制
- 系统管理员账号仅由系统超级管理员创建。
- 验证接口 `/api/vertify` 为统一授权入口。
- 所有关键操作需记录操作日志以备审计。

## 三、总体设计

### 3.1 系统设计原则
- 轻量化与 Serverless 优先。
- 权限边界清晰，角色分权。
- 接口统一，跨平台行为一致。
- 操作可追溯，日志完整。

### 3.2 系统结构
```
[官网门户/角色登录]
        |
        v
[角色 Dashboard] <-> [Workers API / Hono]
                               |
               +---------------+---------------+
               |                               |
             [D1]                           [R2/KV]
```

### 3.3 处理流程（概要）
1. 系统用户创建团队与项目，生成项目唯一 ID。
2. 系统用户批量生成许可证并分发给客户端。
3. 客户端调用 `/api/vertify` 进行授权校验。
4. 后端记录校验日志并沉淀统计数据。

### 3.4 模块划分
- **账户与角色模块**：超级管理员/系统管理员/系统用户的身份与权限。
- **团队模块**：团队创建、成员加入、团队状态管理。
- **项目模块**：项目创建、状态管理、项目 ID 管理。
- **许可证模块**：批量生成、查询详情、验证记录。
- **统计模块**：按时间范围统计访问量、用户唯一标识、许可证编号。
- **日志模块**：管理员与用户操作日志。
- **验证接口模块**：统一授权校验入口。
- **门户与 Dashboard**：官网首页与角色化管理界面。

### 3.5 功能需求与模块关系（简述）
- 角色与权限 -> 账户与角色模块 + 日志模块。
- 团队/项目管理 -> 团队模块 + 项目模块。
- 许可证生成与验证 -> 许可证模块 + 验证接口模块。
- 数据统计 -> 统计模块。

### 3.6 尚未解决的问题
- 许可证规则扩展（如试用期、离线授权）仍需后续补充设计。

## 四、接口设计

### 4.1 外部接口
- **授权验证**：`POST /api/vertify`，JSON 请求体，包含客户端时间、系统凭证、许可证凭证、项目 ID；响应包含系统时间与验证结果。
- **门户入口**：官网首页提供三类角色登录入口与教程内容。

### 4.2 内部接口
- 许可证模块依赖项目模块的项目 ID 与归属关系。
- 统计模块依赖验证接口模块写入的校验日志。

## 五、数据结构设计（概要）

### 5.1 主要实体
- **用户**：系统用户基础信息、状态。
- **管理员**：系统管理员/超级管理员信息、状态。
- **团队**：名称、成员、状态。
- **项目**：名称、团队归属、项目 ID、状态。
- **许可证**：编号、绑定用户唯一标识、创建时间、首次使用、最后验证时间。
- **日志**：操作者、对象、时间、结果。

## 六、数据库设计（概要）
- **D1**：用户、管理员、团队、项目、许可证、日志等结构化数据。
- **KV**：轻量配置与缓存。
- **R2**：对象资源（如导出文件、媒体等）。

## 七、用户界面设计（概要）
- 官网首页：展示功能/教程，提供角色登录入口。
- 角色 Dashboard：按权限展示团队、项目、许可证、统计等功能。

## 八、出错处理设计（概要）
- **认证/授权错误**：提示无权限或凭证无效。
- **资源不存在**：提示项目/团队/许可证不存在。
- **系统错误**：提示服务不可用并记录日志。
